### 实时传输网络系统研究

#### 1. 传输原则

**经过大量在实际网络环境测试，得出以下结论：**
   - 音频尽量用UDP传输，音频怕延迟和乱序；
   - 视频尽量用TCP传输，视频怕丢包；

#### 2. 网络流控原则（应用层做流控）
-  设置一定的数值进行传输数量的控制；
-  在时间范围内重新发送数据包；

#### 3. 网络反馈原理及原则

#### 4. 一些算法与策略

##### *(1)基于NACK反馈的丢包重传*
- 接收端(R)循环检测接收缓冲(或者是抖动缓冲)，当发现丢包后，及时发送RTCP NACK将反馈报文的丢包信息反馈给发送端(S); 发送端(S)收到NACK的数据包并解析后从发送缓存取出相对应的RTP包，再次发送给接收端(R)；
- **缺点：**增大了端到端的延迟，尤其是发生大量数据丢包时更为明显；

##### *(1)FEC算法*

 -   **前向纠错**  简称FEC(Forward Error Correction)，其原理是：发送方将要发送的数据附加上一定的冗余纠错码一并发送，接收方则根据纠错码对数据进行差错检测，如发现差错，由接收方进行纠正，特点：使用纠错码（纠错码编码效率低且设备复杂）、单向信道、发送方无需设置缓冲器。
 -   **优点：**视频没有延迟
 -   **缺点：**由于发送数据冗余包占用了额外的网络带宽
 -   参考 [OPENFEC](http://openfec.org)

##### *(3)拥塞控制与自适应带宽调整*

>拥塞控制技术的提出由来已久，TCP协议栈默认实现了对网络的拥塞控制以保证可靠传输。但在一些场合TCP并不适用，如：无线传输信道，高速长距传输网络、实时通讯应用等。为此，IETF RMCAT（RTP MediaCongestion Avoidance Techniques）工作组提出了一系列针对实时通讯应用的拥塞控制算法需求，包括：能有效控制端到端时延、能有效控制丢包、与其他应用的流共享链路带宽、能够与TCP长连接流公平竞争可用链路带宽等。Google、Cisco和Ericsson等公司相继提出了各自的适用于实时交互应用的拥塞控制算法，开源工程WebRTC的内部实现采用Google提出的算法：Google Congestion Control，简称GCC。

**GCC算法是一种混合了基于丢包和基于时延的方法，原理如下：**

- 发送端根据丢包调整目标带宽，具体来说：低丢包率（小于2%）时增加目标码率，高丢包率（大于10%）时减小目标码率，丢包率介于二者之间时目标码率保持不变；
- 接收端根据时延估计最大带宽，由三个模块组成：排队时延估计、链路过载检测和最大带宽估计模块，三个模块间的关系为：当排队时延小于阈值（根据网络状态自适应调整）时，链路检测结果为underuse；当排队时延大于阈值时，链路检测结果为overuse；介于二者之间时，链路检测结果为normal；最大带宽估计模块的实现是一个表示当前链路状态（Increase、Hold、Decrease）的有限状态机，初始状态为Hold，根据链路检测结果进行状态迁移，并根据迁移后的链路状态和当前接收码率估计最大带宽REMB。

##### 6. WebRTC的网络相关流控和反馈

- **码率控值** [webrtc/modules/bitrate_controller]()
- **拥塞控制** [webrtc/modules/congestion_controller]()
- **REMB** [webrtc/modules/remote_bitrate_estimator]()
